(this.webpackJsonp=this.webpackJsonp||[]).push([[23],{WW8A:function(e,t,s){"use strict";var a=s("Cxqz"),i=s.n(a),n=s("4pZC"),o=s.n(n),r=(s("uHfJ"),s("R0RX"),s("JHu5"),s("3R5X"),s("XUYm"),s("H8gz")),l=s("9LGn"),d=s("6oy4"),u=s.n(d),c=(s("Skdl"),s("teVv")),g=s("uY7R"),p=s("mphk"),h=s("vRHk"),m=s("t9l/"),f=s("ZYR5"),b=s("Zxcm"),v=(s("WmlO"),s("W9Nl"),s("KFH7")),w=s("cuRJ"),y=s("3saJ"),_=s("uSzn"),k=s("ly/8"),S=s("uw3E"),C=s("oj/M"),B=s("drCS"),q={components:{GlButton:w.a},directives:{GlTooltip:k.a},props:{buttonTitle:{type:String,required:!0},icon:{type:String,required:!0},tag:{type:String,required:!1,default:""},tagBlock:{type:String,required:!1,default:""},tagSelect:{type:String,required:!1,default:""},prepend:{type:Boolean,required:!1,default:!1},tagContent:{type:String,required:!1,default:""},cursorOffset:{type:Number,required:!1,default:0},command:{type:String,required:!1,default:""},shortcuts:{type:[String,Array],required:!1,default:function(){return[]}}},computed:{shortcutsString(){const e=Array.isArray(this.shortcuts)?this.shortcuts:[this.shortcuts];return JSON.stringify(e)}}},M=s("bPvS"),T={components:{ToolbarButton:Object(M.a)(q,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("gl-button",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip"}],staticClass:"js-md",attrs:{"data-md-tag":e.tag,"data-md-cursor-offset":e.cursorOffset,"data-md-select":e.tagSelect,"data-md-block":e.tagBlock,"data-md-tag-content":e.tagContent,"data-md-prepend":e.prepend,"data-md-shortcuts":e.shortcutsString,"data-md-command":e.command,title:e.buttonTitle,"aria-label":e.buttonTitle,icon:e.icon,type:"button",category:"tertiary","data-container":"body"},on:{click:function(t){return e.$emit("click",t)}}})}),[],!1,null,null,null).exports,GlPopover:v.a,GlButton:w.a,GlTabs:y.a,GlTab:_.a},directives:{GlTooltip:k.a},props:{previewMarkdown:{type:Boolean,required:!0},lineContent:{type:String,required:!1,default:""},canSuggest:{type:Boolean,required:!1,default:!0},showSuggestPopover:{type:Boolean,required:!1,default:!1},suggestionStartIndex:{type:Number,required:!1,default:0},enablePreview:{type:Boolean,required:!1,default:!0},restrictedToolBarItems:{type:Array,required:!1,default:function(){return[]}}},data:()=>({tag:"> ",suggestPopoverVisible:!1}),computed:{mdTable(){const e=Object(m.g)("MarkdownEditor|header"),t="-".repeat(e.length),s=" ".repeat(e.length);return[`| ${e} | ${e} |`,`| ${t} | ${t} |`,`| ${s} | ${s} |`,`| ${s} | ${s} |`].join("\n")},mdSuggestion(){return[["```",`suggestion:-${this.suggestionStartIndex}+0`].join(""),"{text}","```"].join("\n")},mdCollapsibleSection:()=>[`<details><summary>${Object(m.g)("MarkdownEditor|Click to expand")}</summary>`,"{text}","</details>"].join("\n"),isMac(){var e,t;return Boolean(null===(e=window.gl)||void 0===e||null===(t=e.client)||void 0===t?void 0:t.isMac)},modifierKey(){return this.isMac?"⌘":Object(m.g)("KeyboardKey|Ctrl+")}},watch:{showSuggestPopover(){this.updateSuggestPopoverVisibility()}},mounted(){u()(document).on("markdown-preview:show.vue",this.previewMarkdownTab),u()(document).on("markdown-preview:hide.vue",this.writeMarkdownTab),this.updateSuggestPopoverVisibility()},beforeDestroy(){u()(document).off("markdown-preview:show.vue",this.previewMarkdownTab),u()(document).off("markdown-preview:hide.vue",this.writeMarkdownTab)},methods:{async updateSuggestPopoverVisibility(){await this.$nextTick(),this.suggestPopoverVisible=this.showSuggestPopover&&this.canSuggest},isValid(e){return!e||e.find(".js-vue-markdown-field").length&&u()(this.$el).closest("form")[0]===e[0]},previewMarkdownTab(e,t){e.target.blur&&e.target.blur(),this.isValid(t)&&this.$emit("preview-markdown")},writeMarkdownTab(e,t){e.target.blur&&e.target.blur(),this.isValid(t)&&this.$emit("write-markdown")},handleSuggestDismissed(){this.$emit("handleSuggestDismissed")},handleQuote(){const e=Object(C.p)();if(!e||!e.textContent)return void(this.tag="> ");this.tag="";const t=B.a.transformGFMSelection(e),s=this.$el.parentNode.querySelector("textarea");B.a.nodeToGFM(t).then((function(t){B.a.insertPastedText(s,e.textContent,B.a.quoted(t))})).catch((function(){}))},handleAttachFile(e){e.preventDefault();const t=u()(this.$el).closest(".gfm-form"),s=t.find(".js-gfm-input");t.find(".div-dropzone").click(),s.focus()}},shortcuts:{bold:Object(S.sb)(S.a),italic:Object(S.sb)(S.O),strikethrough:Object(S.sb)(S.mb),link:Object(S.sb)(S.P),indent:Object(S.sb)(S.F),outdent:Object(S.sb)(S.Z)},i18n:{writeTabTitle:Object(m.a)("Write"),previewTabTitle:Object(m.a)("Preview")}},A=Object(M.a)(T,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"md-header"},[s("gl-tabs",{attrs:{"content-class":"gl-display-none"},scopedSlots:e._u([{key:"tabs-end",fn:function(){return[s("div",{staticClass:"md-header-toolbar gl-ml-auto gl-py-2 gl-justify-content-center",class:{"gl-display-none!":e.previewMarkdown},attrs:{"data-testid":"md-header-toolbar"}},[e.canSuggest?[s("toolbar-button",{ref:"suggestButton",staticClass:"js-suggestion-btn",attrs:{tag:e.mdSuggestion,prepend:!0,"button-title":e.__("Insert suggestion"),"cursor-offset":4,"tag-content":e.lineContent,icon:"doc-code","data-qa-selector":"suggestion_button"},on:{click:e.handleSuggestDismissed}}),e._v(" "),e.suggestPopoverVisible?s("gl-popover",{attrs:{target:e.$refs.suggestButton.$el,"css-classes":["diff-suggest-popover"],placement:"bottom",show:e.suggestPopoverVisible}},[s("strong",[e._v(e._s(e.__("New! Suggest changes directly")))]),e._v(" "),s("p",{staticClass:"mb-2"},[e._v("\n              "+e._s(e.__("Suggest code changes which can be immediately applied in one click. Try it out!"))+"\n            ")]),e._v(" "),s("gl-button",{attrs:{variant:"confirm",category:"primary",size:"small","data-qa-selector":"dismiss_suggestion_popover_button"},on:{click:e.handleSuggestDismissed}},[e._v("\n              "+e._s(e.__("Got it"))+"\n            ")])],1):e._e()]:e._e(),e._v(" "),s("toolbar-button",{attrs:{tag:"**","button-title":e.sprintf(e.s__("MarkdownEditor|Add bold text (%{modifierKey}B)"),{modifierKey:e.modifierKey}),shortcuts:e.$options.shortcuts.bold,icon:"bold"}}),e._v(" "),s("toolbar-button",{attrs:{tag:"_","button-title":e.sprintf(e.s__("MarkdownEditor|Add italic text (%{modifierKey}I)"),{modifierKey:e.modifierKey}),shortcuts:e.$options.shortcuts.italic,icon:"italic"}}),e._v(" "),e.restrictedToolBarItems.includes("strikethrough")?e._e():s("toolbar-button",{attrs:{tag:"~~","button-title":e.sprintf(e.s__("MarkdownEditor|Add strikethrough text (%{modifierKey}⇧X)"),{modifierKey:e.modifierKey}),shortcuts:e.$options.shortcuts.strikethrough,icon:"strikethrough"}}),e._v(" "),e.restrictedToolBarItems.includes("quote")?e._e():s("toolbar-button",{attrs:{prepend:!0,tag:e.tag,"button-title":e.__("Insert a quote"),icon:"quote"},on:{click:e.handleQuote}}),e._v(" "),s("toolbar-button",{attrs:{tag:"`","tag-block":"```","button-title":e.__("Insert code"),icon:"code"}}),e._v(" "),s("toolbar-button",{attrs:{tag:"[{text}](url)","tag-select":"url","button-title":e.sprintf(e.s__("MarkdownEditor|Add a link (%{modifierKey}K)"),{modifierKey:e.modifierKey}),shortcuts:e.$options.shortcuts.link,icon:"link"}}),e._v(" "),e.restrictedToolBarItems.includes("bullet-list")?e._e():s("toolbar-button",{attrs:{prepend:!0,tag:"- ","button-title":e.__("Add a bullet list"),icon:"list-bulleted"}}),e._v(" "),e.restrictedToolBarItems.includes("numbered-list")?e._e():s("toolbar-button",{attrs:{prepend:!0,tag:"1. ","button-title":e.__("Add a numbered list"),icon:"list-numbered"}}),e._v(" "),e.restrictedToolBarItems.includes("task-list")?e._e():s("toolbar-button",{attrs:{prepend:!0,tag:"- [ ] ","button-title":e.__("Add a checklist"),icon:"list-task"}}),e._v(" "),e.restrictedToolBarItems.includes("indent")?e._e():s("toolbar-button",{staticClass:"gl-display-none",attrs:{"button-title":e.sprintf(e.s__("MarkdownEditor|Indent line (%{modifierKey}])"),{modifierKey:e.modifierKey}),shortcuts:e.$options.shortcuts.indent,command:"indentLines",icon:"list-indent"}}),e._v(" "),e.restrictedToolBarItems.includes("outdent")?e._e():s("toolbar-button",{staticClass:"gl-display-none",attrs:{"button-title":e.sprintf(e.s__("MarkdownEditor|Outdent line (%{modifierKey}[)"),{modifierKey:e.modifierKey}),shortcuts:e.$options.shortcuts.outdent,command:"outdentLines",icon:"list-outdent"}}),e._v(" "),e.restrictedToolBarItems.includes("collapsible-section")?e._e():s("toolbar-button",{attrs:{tag:e.mdCollapsibleSection,prepend:!0,"tag-select":"Click to expand","button-title":e.__("Add a collapsible section"),icon:"details-block"}}),e._v(" "),e.restrictedToolBarItems.includes("table")?e._e():s("toolbar-button",{attrs:{tag:e.mdTable,prepend:!0,"button-title":e.__("Add a table"),icon:"table"}}),e._v(" "),e.restrictedToolBarItems.includes("attach-file")?e._e():s("gl-button",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip"}],attrs:{title:e.__("Attach a file or image"),"data-testid":"button-attach-file",category:"tertiary",icon:"paperclip"},on:{click:e.handleAttachFile}}),e._v(" "),e.restrictedToolBarItems.includes("full-screen")?e._e():s("toolbar-button",{staticClass:"js-zen-enter",attrs:{prepend:!0,"button-title":e.__("Go full screen"),icon:"maximize"}})],2)]},proxy:!0}])},[s("gl-tab",{attrs:{"title-link-class":"gl-py-4 gl-px-3 js-md-write-button",title:e.$options.i18n.writeTabTitle,active:!e.previewMarkdown,"data-testid":"write-tab"},on:{click:function(t){return e.writeMarkdownTab(t)}}}),e._v(" "),e.enablePreview?s("gl-tab",{attrs:{"title-link-class":"gl-py-4 gl-px-3 js-md-preview-button",title:e.$options.i18n.previewTabTitle,active:e.previewMarkdown,"data-testid":"preview-tab"},on:{click:function(t){return e.previewMarkdownTab(t)}}}):e._e()],1)],1)}),[],!1,null,null,null).exports,x=s("u1ru"),$=s("zLBL"),j=s("nPFI"),P={components:{GlButton:w.a,GlLink:x.a,GlLoadingIcon:$.a,GlSprintf:j.a,GlIcon:r.a},props:{markdownDocsPath:{type:String,required:!0},quickActionsDocsPath:{type:String,required:!1,default:""},canAttachFile:{type:Boolean,required:!1,default:!0},showCommentToolBar:{type:Boolean,required:!1,default:!0}},computed:{hasQuickActionsDocsPath(){return""!==this.quickActionsDocsPath}}};function O(e){return i()(Object(h.x)(e).replace(/\\n/g,"%br").replace(/\n/g,""))}var D={components:{MarkdownHeader:A,MarkdownToolbar:Object(M.a)(P,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.showCommentToolBar?s("div",{staticClass:"comment-toolbar clearfix"},[s("div",{staticClass:"toolbar-text"},[!e.hasQuickActionsDocsPath&&e.markdownDocsPath?[s("gl-sprintf",{attrs:{message:e.s__("MarkdownToolbar|Supports %{markdownDocsLinkStart}Markdown%{markdownDocsLinkEnd}")},scopedSlots:e._u([{key:"markdownDocsLink",fn:function(t){var a=t.content;return[s("gl-link",{attrs:{href:e.markdownDocsPath,target:"_blank"}},[e._v(e._s(a))])]}}],null,!1,2510066785)})]:e._e(),e._v(" "),e.hasQuickActionsDocsPath&&e.markdownDocsPath?[s("gl-sprintf",{attrs:{message:e.s__("NoteToolbar|Supports %{markdownDocsLinkStart}Markdown%{markdownDocsLinkEnd}. For %{quickActionsDocsLinkStart}quick actions%{quickActionsDocsLinkEnd}, type %{keyboardStart}/%{keyboardEnd}.")},scopedSlots:e._u([{key:"markdownDocsLink",fn:function(t){var a=t.content;return[s("gl-link",{attrs:{href:e.markdownDocsPath,target:"_blank"}},[e._v(e._s(a))])]}},{key:"keyboard",fn:function(t){var a=t.content;return[s("kbd",[e._v(e._s(a))])]}},{key:"quickActionsDocsLink",fn:function(t){var a=t.content;return[s("gl-link",{attrs:{href:e.quickActionsDocsPath,target:"_blank"}},[e._v(e._s(a))])]}}],null,!1,1415694541)})]:e._e()],2),e._v(" "),e.canAttachFile?s("span",{staticClass:"uploading-container gl-line-height-32"},[s("span",{staticClass:"uploading-progress-container hide"},[s("gl-icon",{attrs:{name:"paperclip"}}),e._v(" "),s("span",{staticClass:"attaching-file-message"}),e._v(" "),s("span",{staticClass:"uploading-progress"},[e._v("0%")]),e._v(" "),s("gl-loading-icon",{attrs:{size:"sm",inline:""}})],1),e._v(" "),s("span",{staticClass:"uploading-error-container hide"},[s("span",{staticClass:"uploading-error-icon"},[s("gl-icon",{attrs:{name:"paperclip"}})],1),e._v(" "),s("span",{staticClass:"uploading-error-message"}),e._v(" "),s("gl-sprintf",{attrs:{message:e.__("%{retryButtonStart}Try again%{retryButtonEnd} or %{newFileButtonStart}attach a new file%{newFileButtonEnd}.")},scopedSlots:e._u([{key:"retryButton",fn:function(t){var a=t.content;return[s("gl-button",{staticClass:"retry-uploading-link gl-vertical-align-baseline",attrs:{variant:"link",category:"primary"}},[e._v("\n            "+e._s(a)+"\n          ")])]}},{key:"newFileButton",fn:function(t){var a=t.content;return[s("gl-button",{staticClass:"markdown-selector attach-new-file gl-vertical-align-baseline",attrs:{variant:"link",category:"primary"}},[e._v("\n            "+e._s(a)+"\n          ")])]}}],null,!1,3180960446)})],1),e._v(" "),s("gl-button",{staticClass:"button-cancel-uploading-files gl-vertical-align-baseline hide",attrs:{variant:"link",category:"primary"}},[e._v("\n      "+e._s(e.__("Cancel"))+"\n    ")])],1):e._e()]):e._e()}),[],!1,null,null,null).exports,GlIcon:r.a,Suggestions:f.a},directives:{SafeHtml:l.a},mixins:[Object(b.a)()],props:{textareaValue:{type:String,required:!0},markdownDocsPath:{type:String,required:!0},isSubmitting:{type:Boolean,required:!1,default:!1},markdownPreviewPath:{type:String,required:!1,default:""},enablePreview:{type:Boolean,required:!1,default:!0},addSpacingClasses:{type:Boolean,required:!1,default:!0},quickActionsDocsPath:{type:String,required:!1,default:""},canAttachFile:{type:Boolean,required:!1,default:!0},uploadsPath:{type:String,required:!1,default:""},enableAutocomplete:{type:Boolean,required:!1,default:!0},line:{type:Object,required:!1,default:null},lines:{type:Array,required:!1,default:function(){return[]}},note:{type:Object,required:!1,default:function(){return{}}},canSuggest:{type:Boolean,required:!1,default:!1},helpPagePath:{type:String,required:!1,default:""},showSuggestPopover:{type:Boolean,required:!1,default:!1},showCommentToolBar:{type:Boolean,required:!1,default:!0},restrictedToolBarItems:{type:Array,required:!1,default:function(){return[]}}},data(){return{markdownPreview:"",referencedCommands:"",referencedUsers:[],hasSuggestion:!1,markdownPreviewLoading:!1,previewMarkdown:!1,suggestions:this.note.suggestions||[],debouncedFetchMarkdownLoading:!1}},computed:{shouldShowReferencedUsers(){return this.referencedUsers.length>=10},lineContent(){if(this.lines.length)return this.lines.map((function(e){const{rich_text:t,text:s}=e;return s||O(t)})).join("\\n");if(this.line){const{rich_text:e,text:t}=this.line;return t||O(e)}return""},lineNumber(){let e;if(this.line){const{new_line:t,old_line:s}=this.line;e=t||s}return e},lineType(){return this.line?this.line.type:""},addMultipleToDiscussionWarning(){return Object(m.h)(Object(m.a)("You are about to add %{usersTag} people to the discussion. They will all receive a notification."),{usersTag:`<strong><span class="js-referenced-users-count">${this.referencedUsers.length}</span></strong>`},!1)},suggestionsStartIndex(){return Math.max(this.lines.length-1,0)}},watch:{isSubmitting(e){if(!e||!this.$refs["markdown-preview"].querySelectorAll)return;const t=this.$refs["markdown-preview"].querySelectorAll("video, audio");t&&t.forEach((function(e){e.pause()}))},textareaValue:{immediate:!0,handler(e,t){const s=/@all([^\w._-]|$)/,a=s.test(e),i=s.test(t),n=i&&!a;!i&&a?(this.debouncedFetchMarkdownLoading=!1,this.debouncedFetchMarkdown()):n&&(this.debouncedFetchMarkdownLoading=!0,this.referencedUsers=[])}},enablePreview:{immediate:!0,handler(e){e||this.showWriteTab()}}},mounted(){return new g.a(u()(this.$refs["gl-form"]),{emojis:this.enableAutocomplete,members:this.enableAutocomplete,issues:this.enableAutocomplete,mergeRequests:this.enableAutocomplete,epics:this.enableAutocomplete,milestones:this.enableAutocomplete,labels:this.enableAutocomplete,snippets:this.enableAutocomplete,vulnerabilities:this.enableAutocomplete,contacts:this.enableAutocomplete},!0)},beforeDestroy(){const e=u()(this.$refs["gl-form"]).data("glForm");e&&e.destroy()},methods:{showPreviewTab(){var e=this;this.previewMarkdown||(this.previewMarkdown=!0,this.textareaValue?(this.markdownPreviewLoading=!0,this.markdownPreview=Object(m.a)("Loading…"),this.fetchMarkdown().then((function(t){return e.renderMarkdown(t)})).catch((function(){return Object(c.createAlert)({message:Object(m.a)("Error loading markdown preview")})}))):this.renderMarkdown())},showWriteTab(){this.markdownPreview="",this.previewMarkdown=!1},fetchMarkdown(){var e=this;return p.a.post(this.markdownPreviewPath,{text:this.textareaValue}).then((function(t){let{data:s}=t;const{references:a}=s;var i;a&&(e.referencedCommands=a.commands,e.referencedUsers=a.users,e.hasSuggestion=(null===(i=a.suggestions)||void 0===i?void 0:i.length)>0,e.suggestions=a.suggestions);return s}))},debouncedFetchMarkdown:o()((function(){var e=this;return this.fetchMarkdown().then((function(){e.debouncedFetchMarkdownLoading&&(e.referencedUsers=[],e.debouncedFetchMarkdownLoading=!1)}))}),400),renderMarkdown(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.markdownPreviewLoading=!1,this.markdownPreview=t.body||Object(m.a)("Nothing to preview."),this.$nextTick().then((function(){return u()(e.$refs["markdown-preview"]).renderGFM()})).catch((function(){return Object(c.createAlert)({message:Object(m.a)("Error rendering Markdown preview")})}))}},safeHtmlConfig:{ADD_TAGS:["gl-emoji"]}},L=Object(M.a)(D,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"gl-form",staticClass:"js-vue-markdown-field md-area position-relative gfm-form",class:{"gl-mt-3 gl-mb-3":e.addSpacingClasses},attrs:{"data-uploads-path":e.uploadsPath}},[s("markdown-header",{attrs:{"preview-markdown":e.previewMarkdown,"line-content":e.lineContent,"can-suggest":e.canSuggest,"enable-preview":e.enablePreview,"show-suggest-popover":e.showSuggestPopover,"suggestion-start-index":e.suggestionsStartIndex,"restricted-tool-bar-items":e.restrictedToolBarItems},on:{"preview-markdown":e.showPreviewTab,"write-markdown":e.showWriteTab,handleSuggestDismissed:function(){return e.$emit("handleSuggestDismissed")}}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.previewMarkdown,expression:"!previewMarkdown"}],staticClass:"md-write-holder"},[s("div",{staticClass:"zen-backdrop"},[e._t("textarea"),e._v(" "),s("a",{staticClass:"zen-control zen-control-leave js-zen-leave gl-text-gray-500",attrs:{href:"#","aria-label":e.__("Leave zen mode")}},[s("gl-icon",{attrs:{size:16,name:"minimize"}})],1),e._v(" "),s("markdown-toolbar",{attrs:{"markdown-docs-path":e.markdownDocsPath,"quick-actions-docs-path":e.quickActionsDocsPath,"can-attach-file":e.canAttachFile,"show-comment-tool-bar":e.showCommentToolBar}})],2)]),e._v(" "),e.hasSuggestion?[s("div",{directives:[{name:"show",rawName:"v-show",value:e.previewMarkdown,expression:"previewMarkdown"}],ref:"markdown-preview",staticClass:"js-vue-md-preview md-preview-holder"},[e.hasSuggestion?s("suggestions",{attrs:{"note-html":e.markdownPreview,"line-type":e.lineType,disabled:!0,suggestions:e.suggestions,"help-page-path":e.helpPagePath}}):e._e()],1)]:[s("div",{directives:[{name:"show",rawName:"v-show",value:e.previewMarkdown,expression:"previewMarkdown"},{name:"safe-html",rawName:"v-safe-html:[$options.safeHtmlConfig]",value:e.markdownPreview,expression:"markdownPreview",arg:e.$options.safeHtmlConfig}],ref:"markdown-preview",staticClass:"js-vue-md-preview md md-preview-holder"})],e._v(" "),e.referencedCommands&&e.previewMarkdown&&!e.markdownPreviewLoading?s("div",{directives:[{name:"safe-html",rawName:"v-safe-html:[$options.safeHtmlConfig]",value:e.referencedCommands,expression:"referencedCommands",arg:e.$options.safeHtmlConfig}],staticClass:"referenced-commands",attrs:{"data-testid":"referenced-commands"}}):e._e(),e._v(" "),e.shouldShowReferencedUsers?s("div",{staticClass:"referenced-users"},[s("gl-icon",{attrs:{name:"warning-solid"}}),e._v(" "),s("span",{directives:[{name:"safe-html",rawName:"v-safe-html:[$options.safeHtmlConfig]",value:e.addMultipleToDiscussionWarning,expression:"addMultipleToDiscussionWarning",arg:e.$options.safeHtmlConfig}]})],1):e._e()],2)}),[],!1,null,null,null);t.a=L.exports},ZYR5:function(e,t,s){"use strict";s("JHu5"),s("3R5X"),s("XUYm");var a=s("9LGn"),i=s("q+nE"),n=s("teVv"),o=s("t9l/");s("WmlO"),s("W9Nl"),s("uHfJ"),s("R0RX"),s("ujLG"),s("HaUQ");function r(e){return e?e.replace(/^( |\+|-)/,""):e}function l(e){return e.filter((function(e){return"match"!==e.type})).map((function(e){return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,text:r(e.text),rich_text:r(e.rich_text)}}(e)}))}var d=s("F+K/"),u=s("H8gz"),c=s("cuRJ"),g=s("zLBL"),p=s("ly/8"),h=s("oj/M"),m=s("OkMp"),f=s("m6pR"),b=s("oSqs"),v=s("Q04j"),w={components:{GlDropdown:m.a,GlDropdownForm:f.a,GlFormTextarea:b.a,GlButton:c.a,GlAlert:v.a},props:{disabled:{type:Boolean,required:!1,default:!1},defaultCommitMessage:{type:String,required:!0},batchSuggestionsCount:{type:Number,required:!1,default:0},errorMessage:{type:String,required:!1,default:null}},data:()=>({message:null}),computed:{dropdownText(){return this.batchSuggestionsCount<=1?Object(o.a)("Apply suggestion"):Object(o.f)("Apply %d suggestion","Apply %d suggestions",this.batchSuggestionsCount)}},methods:{onApply(){this.$emit("apply",this.message)}}},y=s("bPvS"),_=Object(y.a)(w,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("gl-dropdown",{attrs:{text:e.dropdownText,disabled:e.disabled,size:"small",boundary:"window",right:"",lazy:"","menu-class":"gl-w-full!","data-qa-selector":"apply_suggestion_dropdown"},on:{shown:function(t){return e.$refs.commitMessage.$el.focus()}}},[s("gl-dropdown-form",{staticClass:"gl-px-4! gl-m-0!"},[s("label",{attrs:{for:"commit-message"}},[e._v(e._s(e.__("Commit message")))]),e._v(" "),e.errorMessage?s("gl-alert",{staticClass:"gl-mb-4",attrs:{variant:"danger",dismissible:!1}},[e._v("\n      "+e._s(e.errorMessage)+"\n    ")]):e._e(),e._v(" "),s("gl-form-textarea",{ref:"commitMessage",attrs:{id:"commit-message",placeholder:e.defaultCommitMessage,"submit-on-enter":"","data-qa-selector":"commit_message_field"},on:{submit:e.onApply},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),e._v(" "),s("gl-button",{staticClass:"gl-w-auto! gl-mt-3 gl-text-center! gl-hover-text-white! gl-transition-medium! float-right",attrs:{category:"primary",variant:"confirm","data-qa-selector":"commit_with_custom_message_button"},on:{click:e.onApply}},[e._v("\n      "+e._s(e.__("Apply"))+"\n    ")])],1)],1)}),[],!1,null,null,null).exports;const k=Object(o.a)("Unable to fully load the default commit message. You can still apply this suggestion and the commit message will be correct.");var S={components:{GlBadge:d.a,GlIcon:u.a,GlButton:c.a,GlLoadingIcon:g.a,ApplySuggestion:_},directives:{"gl-tooltip":p.a},props:{batchSuggestionsCount:{type:Number,required:!1,default:0},canApply:{type:Boolean,required:!1,default:!1},isApplied:{type:Boolean,required:!0,default:!1},isBatched:{type:Boolean,required:!1,default:!1},isApplyingBatch:{type:Boolean,required:!1,default:!1},helpPagePath:{type:String,required:!0},defaultCommitMessage:{type:String,required:!1,default:null},inapplicableReason:{type:String,required:!1,default:null},suggestionsCount:{type:Number,required:!1,default:0},failedToLoadMetadata:{type:Boolean,required:!1,default:!1}},data:()=>({isApplyingSingle:!1}),computed:{isApplying(){return this.isApplyingSingle||this.isApplyingBatch},tooltipMessage(){return this.canApply?this.batchSuggestionsCount>1?Object(o.a)("This also resolves all related threads"):Object(o.a)("This also resolves this thread"):this.inapplicableReason},isDisableButton(){return this.isApplying||!this.canApply},applyingSuggestionsMessage(){return this.isApplyingSingle||this.batchSuggestionsCount<2?Object(o.a)("Applying suggestion..."):Object(o.a)("Applying suggestions...")},isLoggedIn:()=>Object(h.A)(),showApplySuggestion(){return!!this.isLoggedIn&&!(this.batchSuggestionsCount>=1&&!this.isBatched)},applySuggestionErrorMessage(){return this.failedToLoadMetadata?k:null}},methods:{apply(e){this.batchSuggestionsCount>1?this.applySuggestionBatch(e):this.applySuggestion(e)},applySuggestion(e){this.canApply&&(this.isApplyingSingle=!0,this.$emit("apply",this.applySuggestionCallback,e))},applySuggestionCallback(){this.isApplyingSingle=!1},applySuggestionBatch(e){this.canApply&&this.$emit("applyBatch",e)},addSuggestionToBatch(){this.$emit("addToBatch")},removeSuggestionFromBatch(){this.$emit("removeFromBatch")}}},C=Object(y.a)(S,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"md-suggestion-header border-bottom-0 gl-px-4 gl-py-3"},[s("div",{staticClass:"js-suggestion-diff-header gl-font-weight-bold"},[e._v("\n    "+e._s(e.__("Suggested change"))+"\n    "),e.helpPagePath?s("a",{staticClass:"js-help-btn",attrs:{href:e.helpPagePath,"aria-label":e.__("Help")}},[s("gl-icon",{attrs:{name:"question-o","css-classes":"link-highlight"}})],1):e._e()]),e._v(" "),e.isApplied?s("gl-badge",{attrs:{variant:"success","data-qa-selector":"applied_badge"}},[e._v("\n    "+e._s(e.__("Applied"))+"\n  ")]):e.isApplying?s("div",{staticClass:"gl-display-flex gl-align-items-center text-secondary",attrs:{"data-qa-selector":"applying_badge"}},[s("gl-loading-icon",{staticClass:"gl-align-items-center gl-justify-content-center gl-mr-3",attrs:{size:"sm"}}),e._v(" "),s("span",[e._v(e._s(e.applyingSuggestionsMessage))])],1):e.isLoggedIn?s("div",{staticClass:"gl-display-flex gl-align-items-center"},[e.isBatched?s("div",[s("gl-button",{staticClass:"btn-inverted js-remove-from-batch-btn btn-grouped",attrs:{disabled:e.isApplying,size:"small"},on:{click:e.removeSuggestionFromBatch}},[e._v("\n        "+e._s(e.__("Remove from batch"))+"\n      ")])],1):!e.isDisableButton&&e.suggestionsCount>1?s("div",[s("gl-button",{staticClass:"btn-inverted js-add-to-batch-btn btn-grouped",attrs:{"data-qa-selector":"add_suggestion_batch_button",disabled:e.isDisableButton,size:"small"},on:{click:e.addSuggestionToBatch}},[e._v("\n        "+e._s(e.__("Add suggestion to batch"))+"\n      ")])],1):e._e(),e._v(" "),e.showApplySuggestion?s("apply-suggestion",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip.viewport",value:e.tooltipMessage,expression:"tooltipMessage",modifiers:{viewport:!0}}],staticClass:"gl-ml-3",attrs:{disabled:e.isDisableButton,"default-commit-message":e.defaultCommitMessage,"batch-suggestions-count":e.batchSuggestionsCount,"error-message":e.applySuggestionErrorMessage},on:{apply:e.apply}}):e._e()],1):e._e()],1)}),[],!1,null,null,null).exports,B={name:"SuggestionDiffRow",directives:{SafeHtml:a.a},props:{line:{type:Object,required:!0}},computed:{displayAsCell(){return!(this.line.rich_text||this.line.text)},lineType(){return this.line.type}}},q={components:{SuggestionDiffHeader:C,SuggestionDiffRow:Object(y.a)(B,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tr",{staticClass:"line_holder",class:e.lineType},[s("td",{staticClass:"diff-line-num old_line border-top-0 border-bottom-0",class:e.lineType},[e._v("\n    "+e._s(e.line.old_line)+"\n  ")]),e._v(" "),s("td",{staticClass:"diff-line-num new_line border-top-0 border-bottom-0",class:e.lineType},[e._v("\n    "+e._s(e.line.new_line)+"\n  ")]),e._v(" "),s("td",{staticClass:"line_content",class:[{"d-table-cell":e.displayAsCell},e.lineType],attrs:{"data-testid":"suggestion-diff-content"}},[e.line.rich_text?s("span",{directives:[{name:"safe-html",rawName:"v-safe-html",value:e.line.rich_text,expression:"line.rich_text"}],staticClass:"line"}):e.line.text?s("span",{staticClass:"line"},[e._v(e._s(e.line.text))]):s("span",{staticClass:"line"})])])}),[],!1,null,null,null).exports},props:{suggestion:{type:Object,required:!0},batchSuggestionsInfo:{type:Array,required:!1,default:function(){return[]}},disabled:{type:Boolean,required:!1,default:!1},helpPagePath:{type:String,required:!0},defaultCommitMessage:{type:String,required:!0},suggestionsCount:{type:Number,required:!1,default:0},failedToLoadMetadata:{type:Boolean,required:!1,default:!1}},computed:{batchSuggestionsCount(){return this.batchSuggestionsInfo.length},isBatched(){var e=this;return Boolean(this.batchSuggestionsInfo.find((function(t){let{suggestionId:s}=t;return s===e.suggestion.id})))},lines(){return l(this.suggestion.diff_lines)}},methods:{applySuggestion(e,t){this.$emit("apply",{suggestionId:this.suggestion.id,callback:e,message:t})},applySuggestionBatch(e){this.$emit("applyBatch",e)},addSuggestionToBatch(){this.$emit("addToBatch",this.suggestion.id)},removeSuggestionFromBatch(){this.$emit("removeFromBatch",this.suggestion.id)}}},M=Object(y.a)(q,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"md-suggestion"},[s("suggestion-diff-header",{staticClass:"js-suggestion-diff-header",attrs:{"suggestions-count":e.suggestionsCount,"can-apply":e.suggestion.appliable&&e.suggestion.current_user.can_apply&&!e.disabled,"is-applied":e.suggestion.applied,"is-batched":e.isBatched,"is-applying-batch":e.suggestion.is_applying_batch,"batch-suggestions-count":e.batchSuggestionsCount,"help-page-path":e.helpPagePath,"default-commit-message":e.defaultCommitMessage,"inapplicable-reason":e.suggestion.inapplicable_reason,"failed-to-load-metadata":e.failedToLoadMetadata},on:{apply:e.applySuggestion,applyBatch:e.applySuggestionBatch,addToBatch:e.addSuggestionToBatch,removeFromBatch:e.removeSuggestionFromBatch}}),e._v(" "),s("table",{staticClass:"mb-3 md-suggestion-diff js-syntax-highlight code"},[s("tbody",e._l(e.lines,(function(e,t){return s("suggestion-diff-row",{key:t+"-"+e.text,attrs:{line:e}})})),1)])],1)}),[],!1,null,null,null).exports,T={directives:{SafeHtml:a.a},props:{lineType:{type:String,required:!1,default:""},suggestions:{type:Array,required:!1,default:function(){return[]}},batchSuggestionsInfo:{type:Array,required:!1,default:function(){return[]}},noteHtml:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1},helpPagePath:{type:String,required:!0},defaultCommitMessage:{type:String,required:!0},suggestionsCount:{type:Number,required:!1,default:0},failedToLoadMetadata:{type:Boolean,required:!1,default:!1}},data:()=>({isRendered:!1}),watch:{suggestions(){this.reset()},noteHtml(){this.reset()},failedToLoadMetadata(){this.reset()}},mounted(){this.renderSuggestions()},beforeDestroy(){this.suggestionsWatch&&this.suggestionsWatch(),this.defaultCommitMessageWatch&&this.defaultCommitMessageWatch()},methods:{renderSuggestions(){var e=this;if(!this.noteHtml)return;const{container:t}=this.$refs,s=t.querySelectorAll(".js-render-suggestion");"old"===this.lineType&&Object(n.createAlert)({message:Object(o.a)("Unable to apply suggestions to a deleted line."),parent:this.$el}),s.forEach((function(t,s){const a=t.parentElement;e.generateDiff(s).$mount(a)})),this.isRendered=!0},generateDiff(e){var t=this;const{suggestions:s,disabled:a,batchSuggestionsInfo:n,helpPagePath:o,defaultCommitMessage:r,suggestionsCount:l,failedToLoadMetadata:d}=this,u=s&&s[e]?s[e]:{},c=new(i.default.extend(M))({propsData:{disabled:a,suggestion:u,batchSuggestionsInfo:n,helpPagePath:o,defaultCommitMessage:r,suggestionsCount:l,failedToLoadMetadata:d}});return this.suggestionsWatch=this.$watch("suggestionsCount",(function(){c.suggestionsCount=t.suggestionsCount})),this.defaultCommitMessageWatch=this.$watch("defaultCommitMessage",(function(){c.defaultCommitMessage=t.defaultCommitMessage})),c.$on("apply",(function(e){let{suggestionId:s,callback:a,message:i}=e;t.$emit("apply",{suggestionId:s,callback:a,flashContainer:t.$el,message:i})})),c.$on("applyBatch",(function(e){t.$emit("applyBatch",{message:e,flashContainer:t.$el})})),c.$on("addToBatch",(function(e){t.$emit("addToBatch",e)})),c.$on("removeFromBatch",(function(e){t.$emit("removeFromBatch",e)})),c},reset(){var e=this;this.$refs.container.innerHTML=this.noteHtml,this.isRendered=!1,this.renderSuggestions(),this.$nextTick((function(){return e.renderSuggestions()}))}}},A=Object(y.a)(T,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{staticClass:"flash-container js-suggestions-flash"}),this._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:this.isRendered,expression:"isRendered"},{name:"safe-html",rawName:"v-safe-html",value:this.noteHtml,expression:"noteHtml"}],ref:"container",staticClass:"md suggestions"})])}),[],!1,null,null,null);t.a=A.exports}}]);
//# sourceMappingURL=commons-pages.projects.feature_flags.edit-pages.projects.feature_flags.new-pages.projects.incidents.-6a29921b.8173a82c.chunk.js.map